<!DOCTYPE html>
<html lang="it">
<head>
  <!-- Meta e responsive -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Stili globali -->
  <link rel="preload" href="./assets/css/style.css" as="style">
  <link rel="stylesheet" href="./assets/css/style.css">

  <!-- Include header/footer -->
  <script src="./assets/js/include.js" defer></script>

  <title>Spazio X — Home</title>
  <link rel="icon" href="./assets/img/favicon.ico" type="image/x-icon">

  <!-- Stili locali -->
  <style>
    /* alza il blocco centrale */
    .flyer-container { transform: translateY(-8svh); }

    /* cornice ridotta */
    .flyer-image {
      height: 200px;
      max-width: 300px;
      width: 100%;
      margin: 0 auto;
    }
    .flyer-image > .flyer-frame {
      height: 100%;
      border: 1px solid #000;
      background: #fafafa;
      display: flex;
      align-items: stretch;
      justify-content: center;
      overflow: hidden; /* niente sbordi del canvas */
    }

    /* canvas di Hydra: riempie la cornice */
    #hydra-canvas {
      width: 100%;
      height: 100%;
      display: block;
      image-rendering: crisp-edges;
    }

    /* piccolo testo sotto la cornice */
    .hydra-credit {
      width: 100%;
      max-width: 300px;
      margin: 4px auto 0;
      text-align: left;
      font-size: 0.6em;
      color: #666;
    }
    .hydra-credit a {
      color: #666;
      text-decoration: none;
      border-bottom: 1px dotted #aaa;
    }
    .hydra-credit a:hover {
      color: #000;
      border-color: #000;
    }

    /* titolo come nelle altre pagine */
    .page-title { text-align: left; }

    /* bottone sopra cornice */
    .home-actions-top {
      width: 100%;
      max-width: 300px;
      margin: 0 auto 10px;
      text-align: center;
    }

    /* bottoni */
    .btn {
      display: inline-block;
      padding: 8px 14px;
      border: 1px solid #888;
      background: #f7f7f7;
      color: #333;
      text-decoration: none;
      font-size: .9em;
      cursor: pointer;
      user-select: none;
    }
    .btn:hover, .btn:focus { background:#eee; color:#000; }

    .home-actions-bottom {
      margin-top: 12px;
      display: flex;
      gap: 16px;
      justify-content: center;
      align-items: center;
    }

    details.dropdown { position: relative; display: inline-block; }
    details.dropdown > summary { list-style: none; outline: none; }
    details.dropdown > summary::-webkit-details-marker { display: none; }
    details.dropdown[open] > summary.btn { background:#eee; }

    .menu {
      position: absolute;
      top: calc(100% + 6px);
      left: 0;
      min-width: 160px;
      border: 1px solid #888;
      background: #fff;
      padding: 6px;
      z-index: 10;
      box-sizing: border-box;
    }
    .menu a {
      display: block;
      padding: 6px 8px;
      border: 1px solid transparent;
      text-decoration: none;
      color: #333;
      font-size: .9em;
    }
    .menu a:hover { border-color:#888; background:#f7f7f7; }
  </style>
</head>

<body>
  <!-- Header iniettato -->
  <div id="header"></div>

  <!-- Titolo come nelle altre pagine -->
  <h1 class="page-title">Spazio X</h1>

  <main class="flyer-container">
    <div class="flyer-block">

      <!-- Pulsante download sopra la cornice -->
      <div class="home-actions-top">
        <a class="btn" href="/assets/docs/programma-ottobre.pdf" download>
          Scarica il programma di ottobre
        </a>
      </div>

      <!-- Cornice con Hydra dentro -->
      <div class="flyer-image">
        <div class="flyer-frame">
          <canvas id="hydra-canvas"></canvas>
        </div>
      </div>

      <!-- ✅ Credito Hydra -->
      <div class="hydra-credit">
        *visual generated with 
        <a href="https://hydra.ojack.xyz/" target="_blank">Hydra</a> by O. Jack
      </div>

      <!-- Bottoni sotto la cornice -->
      <div class="home-actions-bottom">
        <details class="dropdown">
          <summary class="btn">eventi</summary>
          <div class="menu">
            <a href="eventi/2025/31-08-yoga-flyer/">31.08.25</a>
            <a href="eventi/2025/27-09-xxx-flyer/">27.09.25</a>
            <a href="eventi/2025/28-09-xxx-flyer/">28.09.25</a>
          </div>
        </details>

        <details class="dropdown">
          <summary class="btn">archivio</summary>
          <div class="menu">
            <a href="eventi/">/eventi</a>
            <a href="artisti/">/artisti</a>
          </div>
        </details>

        <button id="randomBtn" class="btn" type="button">?</button>
      </div>

    </div>
  </main>

  <div id="footer"></div>

  <!-- Hydra nella cornice -->
  <script src="https://cdn.jsdelivr.net/npm/hydra-synth/dist/hydra-synth.js"></script>
  <script>
    // Inizializza Hydra sul canvas della cornice
    const hydraCanvas = document.getElementById('hydra-canvas');
    const hydra = new Hydra({
      canvas: hydraCanvas,
      detectAudio: false
    });

    // Patch attuale
    osc(4, 0.1, 1.2)
      .modulateScale(osc(8).rotate(Math.sin(time)),.5)
      .thresh(.8)
      .modulateRotate(osc(7),.4)
      .thresh(.7)
      .diff(src(o0).scale(1.8))
      .modulateScale(osc(2).modulateRotate(o0,.74))
      .diff(src(o0).rotate([-.012,.01,-.002,0]).scrollY(0,[-1/199800,0].fast(0.7)))
      .out();

    // Bottone “?” casuale
    const RANDOM_LINKS = [
      '/eventi/2025/31-08-yoga-flyer/',
      '/eventi/2025/31-08-yoga-info/',
      '/eventi/',
      '/artisti/',
      '/artisti/pino-scoppon/'
    ];
    document.getElementById('randomBtn').addEventListener('click', () => {
      const url = RANDOM_LINKS[Math.floor(Math.random() * RANDOM_LINKS.length)];
      location.href = url;
    });

    // Chiudi altri dropdown quando se ne apre uno
    document.querySelectorAll('details.dropdown summary').forEach(s => {
      s.addEventListener('click', () => {
        const parent = s.parentElement;
        document.querySelectorAll('details.dropdown[open]').forEach(d => {
          if (d !== parent) d.removeAttribute('open');
        });
      });
    });
  </script>
</body>
</html>
